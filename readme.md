# Сдача проектной работы 2

В этом уроке вам предстоит сдать проектную работу второго спринта.  
Здесь вы найдёте описание заданий и форму, в которую нужно отправить ответ.  
Она появится после нажатия на кнопку **«Сдать работу»** в конце страницы.

**Желаем приятной работы!**

---

## Кейс компании Hotelio

Вы поработаете с кейсом компании **Hotelio**.

**Hotelio** — онлайн-платформа для бронирования отелей и апартаментов.  
У неё около **1 млн зарегистрированных пользователей**, и основной трафик приходится на поиск и бронирование жилья.

Система построена на **Java-монолите**, который обеспечивает API для клиентов и партнёрских каналов.

---

## Проблематика

Сервис **Hotelio** реализован как единое приложение, в котором:

- все бизнес-функции собраны в одном коде;
- разворачиваются как единый сервис;
- используют одну базу данных.

С ростом бизнеса возникли серьёзные архитектурные и операционные проблемы.  
Команда приняла решение о переходе на **микросервисную архитектуру** с постепенным выносом сервисов.

---

## Текущие проблемы

### 1. Сложность сопровождения

- Любое изменение требует понимания всей кодовой базы.
- Невозможно менять один модуль, не затрагивая другие.

### 2. Низкая масштабируемость

- При пиковых нагрузках (например, на бронирование) нельзя масштабировать только нужный компонент.
- Производительность неравномерна.

### 3. Невозможность гибкой разработки

- Разные команды не могут работать независимо.
- Трудно внедрить быстрый CI/CD.

### 4. Ограничения на фронтенде

- REST API монолита слишком универсален и плохо адаптируется под разные платформы.
- Нет поддержки BFF.

### 5. Сложности с запуском новых фич

- Большой риск ошибок из-за плотной связанности.
- Тестирование требует понимания всех зависимостей.

---

Вам как раз предстоит более детально проанализировать архитектуру системы и выделить наиболее критичные проблемы.

---

## Лендскейп компании

### Структура IT-отдела:

- два разработчика на Java;
- архитектор, который в том числе пишет код;
- фронтенд-разработчик;
- DevOps-инженер;
- тестировщик;
- продукт-менеджер.

### Текущая инфраструктура

- Java Spring Boot (монолит и сервисы);
- PostgreSQL;
- Kafka;
- Docker.

---

## Архитектура системы

![current_architecture.png](sprint_stuff/current_architecture.png)

**Код диаграммы в PlantUML:** [current_architecture.puml](sprint_stuff/current_architecture.puml)

### Назначение модулей

#### BookingService

Обрабатывает создание бронирований.  
Выполняет все проверки: пользователя, отеля, промокода, отзывов.  
Вычисляет финальную цену, скидку и сохраняет результат.

#### UserService

Проверяет статус пользователя: активен ли он, не находится ли в чёрном списке.  
И возвращает его статус.

#### HotelService

Предоставляет информацию об отелях.  
Используется для валидации бронирования и отображения информации в интерфейсе.

#### PromoCodeService

Проверяет промокоды: действительность, применимость к конкретному пользователю.

#### ReviewService

Отвечает за отзывы и рейтинг отеля.  
Влияет на возможность бронирования, если у отеля плохая репутация.

---

## Цели бизнеса

Начать поэтапный переход к микросервисной архитектуре, применяя паттерн **Strangler Fig**, — выносить по одному
компоненту, оставляя остальной функционал в монолите.

Это позволит:

- упростить масштабирование;
- снизить время выхода фич;
- повысить отказоустойчивость;
- упростить независимую разработку разных команд.

## Финальное целевое состояние через год

- Полный переход на микросервисную архитектуру.
- Service mesh с автоматизированными rollouts.
- Масштабируемая Kafka-инфраструктура.
- Метрики и трассировка на каждый сервис.
- GraphQL для фронтенда.

---

> ## В рамках проектной работы
>
> Нужно спроектировать изменения в ближайшей перспективе.  
> А именно промежуточное состояние через пару месяцев:
>
> - Мигрировано несколько сервисов.
> - Старые сервисы не дорабатываются.
> - Новая функциональность пишется только уже в мигрированных сервисах.
> - Начато разделение баз для балансировки нагрузки и переезда в облако.

### Что нужно сделать

Сделайте форк репозитория с исходными файлами для выполнения проектной работы:  
https://github.com/Yandex-Practicum/msa-sprint2

Проект состоит из четырёх заданий.  
Для них в репозитории создана папка `tasks`.

Работать над заданиями вы можете в удобном месте.  
Результаты же сложите в подпапку `results` для каждого из четырёх заданий.

Когда вы выполните все задания проекта, создайте **пул-реквест** из веток с результатами заданий в основную ветку вашего
репозитория.  
Убедитесь, что пул-реквест содержит все изменения, которые вы вносили.

---

## Какие инструменты нужны для работы

Для работы над заданиями вам понадобятся:

- Docker Compose
- IDE
- PlantUML

> Приложение написано на Java. Мы понимаем, что не все имеют опыт работы с Java,
> и поэтому сделали приложение простым и интуитивно понятным. В целом важно понимать,
> что специалисты, занимающиеся проработкой архитектуры системы, часто осваивают новые для себя технологии.
> Работа над этим проектом поможет вам легче адаптироваться к будущим задачам
> с неизвестным стеком.

# Задание 1. Проработка миграции от монолита к микросервисам

**Цель задания:** подготовить архитектурный анализ и план начала миграции на микросервисы.

Впереди масштабная трансформация — разделение монолитного Java-приложения на независимые сервисы.

---

## Что нужно сделать

1. Изучите текущий код монолита.  
   В директории `architecture` в `readme.md` вы найдёте описание модулей системы, структуру проекта и список
   API-эндпоинтов и их поведение.

2. Составьте **ADR**.  
   Оно будет описывать целевое состояние системы. Выберите уровень детализации и количество диаграмм и ADR.

    - Подсветите ключевые проблемы — существующие и найденные вами.
    - Предложите опции решений и их дизайн — как решить текущие проблемы.
    - Прописать план миграции — как перейти к целевому состоянию.

3. Поскольку ресурсы ограничены, начать миграцию нужно с одного модуля.  
   Определите, какой модуль это будет, и обоснуйте, почему именно он.  
   Сформулируйте план на основе **Strangler Fig**.

4. Перед переходом к заданию запустите приложение и базу данных, выполните тесты (см. `tests/readme`).  
   Это поможет лучше понять архитектуру системы.

5. Чтобы сдать решение в формате ADR, используйте шаблон [adr_template.md](sprint_stuff/adr_template.md).

В `README.md` лежит дополнительная информация о работе системы и советы по работе над заданиями. Обратите на них
внимание.

## Подсказки по подготовке окружения, сборке и запуску приложения

### Подготовка окружения

Установите **Docker** и **Docker Compose**.

Создайте **Docker-сеть** (если ещё не создана):

`docker network create hotelio-net`

Для удобства просмотра кода может понадобиться:

- Установите **JDK 17**
- Установите **Gradle** (или используйте встроенную в Idea)
- Установить **Idea** или **Visual Studio Code**

---

### Сборка приложения

`./gradlew build`

---

### Запуск приложения

`docker-compose up -d --build`

---

### Получаемые компоненты

- **PostgreSQL** (порт 5432) (5432 host машина)
- **hotelio-monolith** (порт 8080) (8084 host машина)

---

### Проверка работоспособности

`curl http://localhost:8084/bookings`

--- 

## Образ результата

Структура и содержание репозитория, в котором нужно сдать решение:

```text
├── ADR/diagram  
└── test-log.txt — выгрузка логов или скриншот проверки API и кодовой базы
```

Загрузите результат в директорию `task1/results/` вашего репозитория.