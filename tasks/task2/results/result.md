# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Ç–æ—Ä–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

## –°–∫—Ä–∏–Ω —Å –æ–±—â–∏–º –≤–∏–¥–æ–º —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. curl –∑–∞–ø—Ä–æ—Å –≤ –º–æ–Ω–æ–ª–∏—Ç (–ª–µ–≤–æ –≤–µ—Ä—Ö)

```shell
curl -sSf -X POST "http://localhost:8084/api/bookings?userId=test-user-2&hotelId=test-hotel-1&promoCode=TESTCODE1"
```

2. –ª–æ–≥–∏ –º–æ–Ω–æ–ª–∏—Ç–∞ (–ø—Ä–∞–≤–æ –≤–µ—Ä—Ö)
3. –ª–æ–≥–∏ grpc —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∏–∑ –º–æ–Ω–æ–ª–∏—Ç–∞ (–ª–µ–≤–æ –Ω–∏–∑)
4. –ª–æ–≥–∏ history —Å–µ—Ä–≤–∏—Å–∞ –≤ –∫–æ—Ç–æ—Ä—ã–π —á–µ—Ä–µ–∑ –∫–∞—Ñ–∫—É grpc —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–±—ã—Ç–∏–µ

![all_works.png](img/all_works.png)

## –õ–æ–≥/—Å–∫—Ä–∏–Ω—à–æ—Ç `docker ps`

![docker_ps.png](img/docker_ps.png)

## test-log.txt (–ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

```text
~/projects/courses/yandex/mswa/msa-sprint2/test on dev ‚á°1 +3 !2 ?4                                                                                                                at 11:42:08 PM
‚ùØ docker run --rm \
  -e DB_HOST=host.docker.internal \
  -e DB_PORT=5432 \
  -e DB_NAME=hotelio \
  -e DB_USER=hotelio \
  -e DB_PASSWORD=hotelio \
  -e API_URL=http://host.docker.internal:8084 \
  hotelio-tester
üèÅ –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏ Hotelio
üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î...
üß™ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–∫—Å—Ç—É—Ä...
DELETE 4
DELETE 3
DELETE 12
DELETE 3
DELETE 0
INSERT 0 4
INSERT 0 3
INSERT 0 12
INSERT 0 3
INSERT 0 2
üß™ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ HTTP-—Ç–µ—Å—Ç–æ–≤...

–¢–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ test-user-1 –ø–æ ID —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –°—Ç–∞—Ç—É—Å test-user-1: ACTIVE
‚úÖ test-user-1 –≤ –±–ª—ç–∫–ª–∏—Å—Ç–µ
‚úÖ test-user-1 –∞–∫—Ç–∏–≤–µ–Ω
‚úÖ test-user-1 –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (–≤ –±–ª—ç–∫–ª–∏—Å—Ç–µ)
‚úÖ test-user-3 ‚Äî VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚úÖ test-user-2 –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

–¢–µ—Å—Ç—ã –æ—Ç–µ–ª–µ–π...
‚úÖ test-hotel-1 –ø–æ–ª—É—á–µ–Ω –ø–æ ID
‚úÖ test-hotel-1 —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ test-hotel-3 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ test-hotel-2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω
‚úÖ –ü–æ–∏—Å–∫ –æ—Ç–µ–ª–µ–π –≤ –°–µ—É–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –¢–æ–ø-–æ—Ç–µ–ª–∏ –≤ –°–µ—É–ª–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

–¢–µ—Å—Ç—ã —Ä–µ–≤—å—é...
‚úÖ –û—Ç–∑—ã–≤—ã test-hotel-1 –Ω–∞–π–¥–µ–Ω—ã
‚úÖ test-hotel-1 –ø—Ä–∏–∑–Ω–∞–Ω –Ω–∞–¥—ë–∂–Ω—ã–º
‚úÖ test-hotel-3 –ù–ï –ø—Ä–∏–∑–Ω–∞–Ω –Ω–∞–¥—ë–∂–Ω—ã–º (–æ–∂–∏–¥–∞–µ–º–æ)

–¢–µ—Å—Ç—ã –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤...
‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ TESTCODE1 –Ω–∞–π–¥–µ–Ω
‚úÖ VIP-–ø—Ä–æ–º–æ –¥–æ—Å—Ç—É–ø–µ–Ω VIP
‚úÖ VIP-–ø—Ä–æ–º–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –æ–±—ã—á–Ω–æ–º—É
‚úÖ –û–±—ã—á–Ω—ã–π –ø—Ä–æ–º–æ –¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ –ò—Å—Ç–µ–∫—à–∏–π –ø—Ä–æ–º–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ POST /validate –ø—Ä–æ–º–æ –ø—Ä–æ—à—ë–ª

–¢–µ—Å—Ç—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...
‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ (–±–µ–∑ –ø—Ä–æ–º–æ)
‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–æ–º–æ –ø—Ä–æ—à–ª–æ
‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è test-user-2 –Ω–∞–π–¥–µ–Ω—ã
‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–æ: –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–æ: –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –æ—Ç–µ–ª—å
‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–æ: –æ—Ç–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω
‚úÖ –í—Å–µ HTTP-—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!
```

## select * from bookings –∏–∑ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ —Å—Ç–∞—Ä–æ–π –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

### –ò–∑ –º–æ–Ω–æ–ª–∏—Ç–∞

```text
[2026-02-15 23:47:12] hotelio.public> select * from booking
[2026-02-15 23:47:12] 2 rows retrieved starting from 1 in 449 ms (execution: 8 ms, fetching: 441 ms)
```

| discount\_percent | price | created\_at                       | id | hotel\_id    | promo\_code | user\_id    |
|:------------------|:------|:----------------------------------|:---|:-------------|:------------|:------------|
| 10                | 90    | 2026-02-15 19:43:16.380336 +00:00 | 13 | test-hotel-1 | TESTCODE1   | test-user-2 |
| 0                 | 80    | 2026-02-15 19:43:16.380336 +00:00 | 14 | test-hotel-1 | null        | test-user-3 |

### –ò–∑ –Ω–æ–≤–æ–≥–æ booking-service

```text
[2026-02-15 23:50:31] booking.public> select * from bookings
[2026-02-15 23:50:32] 2 rows retrieved starting from 1 in 404 ms (execution: 7 ms, fetching: 397 ms)
```

| id | user\_id    | hotel\_id    | promo\_code | discount\_percent | price | created\_at                       |
|:---|:------------|:-------------|:------------|:------------------|:------|:----------------------------------|
| 21 | test-user-3 | test-hotel-1 | null        | 0                 | 80    | 2026-02-15 19:43:16.637620 +00:00 |
| 22 | test-user-2 | test-hotel-1 | TESTCODE1   | 10                | 90    | 2026-02-15 19:43:16.672848 +00:00 |

## README.md —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ To Be

–ü–æ–¥—Ä–æ–±–Ω–æ —ç—Ç–æ —Ä–∞—Å–ø–∏—Å—ã–≤–∞–ª —ç—Ç–æ –≤ adr –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –≤–æ—Ç —Ç—É—Ç: [adr.md](../../task1/results/adr.md)

## select * –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è—Ö

```text
[2026-02-15 23:54:41] booking_history.public> select * from booking_history
[2026-02-15 23:54:41] 2 rows retrieved starting from 1 in 366 ms (execution: 7 ms, fetching: 359 ms)
```

| id | booking\_id | user\_id    | hotel\_id    | promo\_code | discount\_percent | price | created\_at                       |
|:---|:------------|:------------|:-------------|:------------|:------------------|:------|:----------------------------------|
| 7  | 21          | test-user-3 | test-hotel-1 | null        | 0                 | 80    | 2026-02-15 19:43:16.637620 +00:00 |
| 8  | 22          | test-user-2 | test-hotel-1 | TESTCODE1   | 10                | 90    | 2026-02-15 19:43:16.672848 +00:00 |

## –î–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π regress.sh (–º–±. init-fixtures)

–ò—Ö –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Å–æ–±–æ –Ω–µ –ø—Ä–∏—à–ª–æ—Å—å (–ø–æ—Ä—è–¥–æ–∫ —Ç–æ–∫ –ø–æ–º–µ–Ω—è–ª), –æ–¥–Ω–∞–∫–æ –ø–æ—Ö–æ–¥—É –≤ —Å–±–∏–ª–∂–µ–Ω–æ–º jar-–Ω–∏–∫–µ –º–æ–Ω–æ–ª–∏—Ç–∞ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
–µ—Å—Ç—å –±–∞–≥–∞, –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∏ –æ—à–∏–±–∫–∞ –ø–∞–¥–∞–µ—Ç –∏–º–µ–Ω–Ω–æ –≤ –º–æ–Ω–æ–ª–∏—Ç–µ, –Ω–µ –¥–æ—Ö–æ–¥—è –¥–æ grpc —Å–µ—Ä–≤–∏—Å–∞

–í–æ—Ç —ç—Ç–æ—Ç –ø–∞–¥–∞–µ—Ç (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å user id)

```text
# 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
curl -sSf "${BASE}/api/bookings" | grep -q 'test-user-2' && pass "–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã" || fail "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã"
```

–í–æ—Ç —ç—Ç–æ—Ç (—Ç–∞ –∂–µ —Ä—É—á–∫–∞ —Ç–æ–ª—å–∫–æ —Å user id) ‚Äî –ø—Ä–æ—Ö–æ–¥–∏—Ç

```text
# 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -sSf "${BASE}/api/bookings?userId=test-user-2" | grep -q 'test-user-2' && pass "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è test-user-2 –Ω–∞–π–¥–µ–Ω—ã" || fail "–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π test-user-2"
```

–ü–æ—á–∏—Ç–∞–ª —Ç—Ä–µ–π—Å –º–æ–ª–æ–ª–∏—Ç–∞, –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ —Ç–æ —á—Ç–æ –≤ protobuf-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è Java —Å–µ—Ç—Ç–µ—Ä—ã –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç null. –ò –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å
null (–Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–µ —é–∑–µ—Ä –∏–¥) –≤ setUserId(...), –≤–Ω—É—Ç—Ä–∏ –±–∏–ª–¥–µ—Ä –∫–∏–¥–∞–µ—Ç NPE
–ö—Ä—á —Å—Ç–æ –ø—Ä–æ—Ü –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ –º–æ–Ω–æ–ª–∏—Ç–∞ –≤ –¥–∂–∞—Ä–Ω–∏–∫–µ

